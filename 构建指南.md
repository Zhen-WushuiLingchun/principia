# 构建与部署指南 (Build Guide)

本指南介绍如何构建 The Principia 以进行生产部署。

## 前置要求

-   **Python 3.10+**
-   **Node.js 18+** & **npm**

## 构建流程

本项目采用前后端分离结构，但在生产环境中通过 Flask 后端统一服务静态资源。因此需要先构建前端。

### 1. 构建前端

进入前端目录并运行构建脚本：

```bash
cd principia
npm install  # 如果尚未安装依赖
npm run build
```

**此步骤执行的操作：**
-   编译 TypeScript 代码。
-   使用 Vite 打包 React 资源。
-   将静态文件（HTML, CSS, JS, Fonts）输出到 `principia/dist/` 目录。

### 2. 准备后端

确保安装了 Python 依赖：

```bash
cd ..  # 返回项目根目录
pip install -r requirements.txt
```

### 3. 生产目录结构

构建完成后，您的目录结构应如下所示：

```
project-root/
├── app.py
├── requirements.txt
└── principia/
    └── dist/          <-- 由 npm run build 生成
        ├── index.html
        ├── assets/
        └── ...
```

## 运行生产服务

`app.py` 已配置为服务 `principia/dist` 目录下的静态文件。

启动服务器：

```bash
python app.py
```

为了更健壮的生产部署，建议使用 WSGI 服务器（如 Linux/Mac 上的 `gunicorn` 或 Windows 上的 `waitress`）替代 Flask 内置的开发服务器。

**Windows 使用 Waitress 示例:**
```bash
pip install waitress
waitress-serve --port=8000 app:app
```

**Linux 使用 Gunicorn 示例:**
```bash
pip install gunicorn
gunicorn -w 4 -b 0.0.0.0:8000 app:app
```

## 故障排除

-   **资源丢失**: 如果页面加载但显示空白或样式丢失，请确保 `npm run build` 成功完成且 `principia/dist` 文件夹存在。
-   **CORS 错误**: 后端已处理 CORS，但请确保在设置中配置的 API Base URL 可以从客户端浏览器访问。
